name: luacheck
description: Runs luacheck.
inputs:
  files:
    description: >
      A list of files, rockspecs, or directories to be checked.

      Defaults to the workspace path as set by the `path` input.
    required: false
    default: '.'
  path:
    description: >
      The working directory for luacheck.

      The file list should be relative to this path and output
      filenames be displayed relative to this path.

      Defaults to the workspace path.
    required: false
    default: ${{ github.workspace }}
  args:
    description: >
      Additional command-line arguments.

      See https://luacheck.readthedocs.io/en/stable/cli.html
    required: false
  config:
    description: >
      URL to a custom configuration (`.luacheckrc`) file that will be
      used as the default configuration file.
    required: false
runs:
  using: composite
  steps:
    - name: Install luacheck
      run: |
        echo "##[group]Install luacheck"
        if ! hash luacheck &>/dev/null; then
          echo "##[command]apt-get install -yq luarocks"
          sudo apt-get install -yq luarocks
          echo "##[command]luarocks install luacheck"
          sudo luarocks install luacheck
          echo "##[command]luarocks install lanes"
          sudo luarocks install lanes
        fi
        echo "##[command]luacheck --version"
        luacheck --version
        echo "##[endgroup]"
      shell: bash
    - name: Install .luacheckrc
      run: |
        [ -z "${{ inputs.config }}" ] && exit 0
        echo "##[group]Install .luacheckrc"
        mkdir -p ~/.config/luacheck
        echo "##[command]curl -fsSL ${{ inputs.config }}"
        curl -fsSL ${{ inputs.config }} > ~/.config/luacheck/.luacheckrc
        echo "##[endgroup]"
      shell: bash
    - name: Run luacheck
      run: luacheck ${{ inputs.args }} -- ${{ inputs.files }}
      working-directory: ${{ inputs.path }}
      shell: bash
